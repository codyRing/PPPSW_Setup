<metadata>
  <Job>
    <Key>Load-BlueCross-Fees</Key>
    <Description null="yes" />
    <CreatedBy>crissler</CreatedBy>
    <CreatedOn>5/12/2020 6:03:59 PM</CreatedOn>
    <UpdatedBy>crissler</UpdatedBy>
    <UpdatedOn>5/13/2020 3:48:14 PM</UpdatedOn>
    <EnableJobInProgressAlert>0</EnableJobInProgressAlert>
    <Execute />
    <Tasks>
      <Task choice="ScanDataFile">
        <Name>ScanDataFile</Name>
        <Disabled>1</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <DataFileSpecKey>ImportBlueCrossSchedule</DataFileSpecKey>
        <FilePath>C:\ClientData\PPPSW\Schedules\BlueCrossSchedulesZD9738.csv</FilePath>
        <TableName>ImportBlueCrossSchedule</TableName>
        <RowTerminator choice="Newline" />
        <ColumnSeparator choice="Comma" />
        <TextQualified>1</TextQualified>
        <MaxRowSize>1000</MaxRowSize>
        <HasHeader>1</HasHeader>
        <MaxInvalidRows>0</MaxInvalidRows>
      </Task>
      <Task choice="LoadDataFile">
        <Name>LoadDataFile</Name>
        <Disabled>1</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <DataFileSpec>ImportBlueCrossSchedule</DataFileSpec>
        <FilePath>C:\ClientData\PPPSW\Schedules\BlueCrossSchedulesZD9738.csv</FilePath>
        <ImportMode choice="Append" />
        <MaxInvalidRows>0</MaxInvalidRows>
      </Task>
      <Task choice="ExecuteSql">
        <Name>Populate ContractMap</Name>
        <Disabled>0</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <Sql>DECLARE @Entity TABLE (Entity VARCHAR(50)
                        ,StartDate date
                        ,EndDate date)

INSERT INTO @Entity (Entity,StartDate,EndDate)
VALUES ('Blue Cross','2019-01-01','2999-12-31')
    


DELETE CM
FROM dbo.ContractMap CM
JOIN @Entity e ON CM.Insurance = e.Entity

INSERT INTO dbo.ContractMap (
    [contract]
    ,FeeLogic
    ,BillType
    ,Facility
    ,Insurance
    ,StartEffectiveDate
    ,EndEffectiveDate
    )
SELECT [contract] = e.Entity
    ,FeeLogic = e.Entity
    ,BillType = BillType.[key]
    ,Facility = Facility.[Key]
    ,Insurance = e.Entity
    ,Starteffectivedate = e.StartDate
    ,EndEffectiveDate = e.EndDate
FROM @Entity e
    ,Facility
    ,BillType</Sql>
      </Task>
      <Task choice="LoadSchedule">
        <Name>Blue Cross Fixed Schedule Locality Four</Name>
        <Disabled>0</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <Schedule>BlueCross-Fixed-Profee-LocalityFour</Schedule>
        <ScheduleType>Carrier-Fixed</ScheduleType>
        <Parameters>
          <Parameter>
            <Key>Insurance</Key>
            <Value>Blue Cross</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>StartDate</Key>
            <Value>2019-01-01</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>EndDate</Key>
            <Value>2999-12-31</Value>
            <Literalize>1</Literalize>
          </Parameter>
        </Parameters>
        <Description>
        </Description>
        <FeeRecordSql>--------------------------------------------ScheduleMap Record Load--------------------------------- 
DELETE s
FROM ScheduleMap s
WHERE [Schedule] = {Schedule}
    AND ScheduleType = {ScheduleType}
    AND insurance = {Insurance}

INSERT INTO ScheduleMap (
    Schedule
    ,ScheduleType
    ,Facility
    ,Insurance
    ,StartEffectiveDate
    ,EndEffectiveDate
    )
SELECT 
    Schedule = {Schedule}
    ,ScheduleType = {ScheduleType}
    ,Facility = facility.[Key]
    ,Insurance = Insurance.[key]
    ,StartEffectiveDate = {StartDate}
    ,EndEffectiveDate = {EndDate}
FROM Facility
    ,Insurance
WHERE 
    Insurance.[Key] = {Insurance}
    AND Facility.Body.value('(Entity/ZipCode)[1]', 'varchar(max)') IN (
        '92270'
        ,'92236'
        )

--------------------------------------------Fee Schedule Record Load--------------------------------- 
DELETE FSR
FROM dbo.FeeScheduleRecord fsr
WHERE fsr.schedule LIKE {Schedule}

INSERT INTO dbo.FeeScheduleRecord (
    Schedule
    ,Member
    ,Filter
    ,[Priority]
    ,Amount
    )
SELECT 
    Schedule = {Schedule}
    ,Member = Code
    --,Filter = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN '%+' + Modifier + '%'
    --                ELSE '%'
    --            END
    ,[Filter] = '%'
    --,[Priority] = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN 2
    --            ELSE 1
    --        END
    ,[Priority] = 1
    ,Amount = GlobalComponent
FROM ImportBlueCrossSchedule AS srce
WHERE srce.area LIKE '4'</FeeRecordSql>
      </Task>
      <Task choice="LoadSchedule">
        <Name>Blue Cross Fixed Schedule Locality Six</Name>
        <Disabled>1</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <Schedule>BlueCross-Fixed-Profee-LocalitySix</Schedule>
        <ScheduleType>Carrier-Fixed</ScheduleType>
        <Parameters>
          <Parameter>
            <Key>Insurance</Key>
            <Value>Blue Cross</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>StartDate</Key>
            <Value>2019-01-01</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>EndDate</Key>
            <Value>2999-12-31</Value>
            <Literalize>1</Literalize>
          </Parameter>
        </Parameters>
        <Description>
        </Description>
        <FeeRecordSql>--------------------------------------------ScheduleMap Record Load--------------------------------- 
DELETE s
FROM ScheduleMap s
WHERE [Schedule] = {Schedule}
    AND ScheduleType = {ScheduleType}
    AND insurance = {Insurance}

INSERT INTO ScheduleMap (
    Schedule
    ,ScheduleType
    ,Facility
    ,Insurance
    ,StartEffectiveDate
    ,EndEffectiveDate
    )
SELECT 
    Schedule = {Schedule}
    ,ScheduleType = {ScheduleType}
    ,Facility = facility.[Key]
    ,Insurance = Insurance.[key]
    ,StartEffectiveDate = {StartDate}
    ,EndEffectiveDate = {EndDate}
FROM Facility
    ,Insurance
WHERE 
    Insurance.[Key] = {Insurance}
    AND Facility.Body.value('(Entity/ZipCode)[1]', 'varchar(max)') IN (
        '92553'
        ,'92881'
		,'92506'
        )

--------------------------------------------Fee Schedule Record Load--------------------------------- 
DELETE FSR
FROM dbo.FeeScheduleRecord fsr
WHERE fsr.schedule LIKE {Schedule}

INSERT INTO dbo.FeeScheduleRecord (
    Schedule
    ,Member
    ,Filter
    ,[Priority]
    ,Amount
    )
SELECT 
    Schedule = {Schedule}
    ,Member = Code
    --,Filter = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN '%+' + Modifier + '%'
    --                ELSE '%'
    --            END
    ,[Filter] = '%'
    --,[Priority] = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN 2
    --            ELSE 1
    --        END
    ,[Priority] = 1
    ,Amount = GlobalComponent
FROM ImportBlueCrossSchedule AS srce
WHERE srce.area LIKE '6'</FeeRecordSql>
      </Task>
      <Task choice="LoadSchedule">
        <Name>Blue Cross Fixed Schedule Locality Seven</Name>
        <Disabled>0</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <Schedule>BlueCross-Fixed-Profee-LocalitySeven</Schedule>
        <ScheduleType>Carrier-Fixed</ScheduleType>
        <Parameters>
          <Parameter>
            <Key>Insurance</Key>
            <Value>Blue Cross</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>StartDate</Key>
            <Value>2019-01-01</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>EndDate</Key>
            <Value>2999-12-31</Value>
            <Literalize>1</Literalize>
          </Parameter>
        </Parameters>
        <Description>
        </Description>
        <FeeRecordSql>--------------------------------------------ScheduleMap Record Load--------------------------------- 
DELETE s
FROM ScheduleMap s
WHERE [Schedule] = {Schedule}
    AND ScheduleType = {ScheduleType}
    AND insurance = {Insurance}

INSERT INTO ScheduleMap (
    Schedule
    ,ScheduleType
    ,Facility
    ,Insurance
    ,StartEffectiveDate
    ,EndEffectiveDate
    )
SELECT 
    Schedule = {Schedule}
    ,ScheduleType = {ScheduleType}
    ,Facility = facility.[Key]
    ,Insurance = Insurance.[key]
    ,StartEffectiveDate = {StartDate}
    ,EndEffectiveDate = {EndDate}
FROM Facility
    ,Insurance
WHERE 
    Insurance.[Key] = {Insurance}
    AND Facility.Body.value('(Entity/ZipCode)[1]', 'varchar(max)') IN (
	'92111'
	,'91911'
	,'92109'
	,'92101'
	,'92101'
	,'92101'
	,'92025'
	,'92105'
	,'92081'
	,'92020'
	,'92115'
	,'92126'
	,'92114'
        )

--------------------------------------------Fee Schedule Record Load--------------------------------- 
DELETE FSR
FROM dbo.FeeScheduleRecord fsr
WHERE fsr.schedule LIKE {Schedule}

INSERT INTO dbo.FeeScheduleRecord (
    Schedule
    ,Member
    ,Filter
    ,[Priority]
    ,Amount
    )
SELECT 
    Schedule = {Schedule}
    ,Member = Code
    --,Filter = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN '%+' + Modifier + '%'
    --                ELSE '%'
    --            END
    ,[Filter] = '%'
    --,[Priority] = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN 2
    --            ELSE 1
    --        END
    ,[Priority] = 1
    ,Amount = GlobalComponent
FROM ImportBlueCrossSchedule AS srce
WHERE srce.area LIKE '7'</FeeRecordSql>
      </Task>
      <Task choice="LoadSchedule">
        <Name>Blue Cross Fixed Schedule Locality Nine</Name>
        <Disabled>0</Disabled>
        <ContinueOnError>0</ContinueOnError>
        <Schedule>BlueCross-Fixed-Profee-LocalityNine</Schedule>
        <ScheduleType>Carrier-Fixed</ScheduleType>
        <Parameters>
          <Parameter>
            <Key>Insurance</Key>
            <Value>Blue Cross</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>StartDate</Key>
            <Value>2019-01-01</Value>
            <Literalize>1</Literalize>
          </Parameter>
          <Parameter>
            <Key>EndDate</Key>
            <Value>2999-12-31</Value>
            <Literalize>1</Literalize>
          </Parameter>
        </Parameters>
        <Description>
        </Description>
        <FeeRecordSql>--------------------------------------------ScheduleMap Record Load--------------------------------- 
DELETE s
FROM ScheduleMap s
WHERE [Schedule] = {Schedule}
    AND ScheduleType = {ScheduleType}
    AND insurance = {Insurance}

INSERT INTO ScheduleMap (
    Schedule
    ,ScheduleType
    ,Facility
    ,Insurance
    ,StartEffectiveDate
    ,EndEffectiveDate
    )
SELECT 
    Schedule = {Schedule}
    ,ScheduleType = {ScheduleType}
    ,Facility = facility.[Key]
    ,Insurance = Insurance.[key]
    ,StartEffectiveDate = {StartDate}
    ,EndEffectiveDate = {EndDate}
FROM Facility
    ,Insurance
WHERE 
    Insurance.[Key] = {Insurance}
    AND Facility.Body.value('(Entity/ZipCode)[1]', 'varchar(max)') IN (
        '92243'
        )

--------------------------------------------Fee Schedule Record Load--------------------------------- 
DELETE FSR
FROM dbo.FeeScheduleRecord fsr
WHERE fsr.schedule LIKE {Schedule}

INSERT INTO dbo.FeeScheduleRecord (
    Schedule
    ,Member
    ,Filter
    ,[Priority]
    ,Amount
    )
SELECT 
    Schedule = {Schedule}
    ,Member = Code
    --,Filter = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN '%+' + Modifier + '%'
    --                ELSE '%'
    --            END
    ,[Filter] = '%'
    --,[Priority] = CASE 
    --                WHEN Modifier IS NOT NULL
    --                    THEN 2
    --            ELSE 1
    --        END
    ,[Priority] = 1
    ,Amount = GlobalComponent
FROM ImportBlueCrossSchedule AS srce
WHERE srce.area LIKE '9'</FeeRecordSql>
      </Task>
    </Tasks>
  </Job>
</metadata>